name: Cafe24 Pro Parameter Campaign

on:
  schedule:
    # 매주 일요일 오전 8:50 KST
    # → UTC 기준 토요일 23:50
    - cron: "50 23 * * 6"
  workflow_dispatch:

jobs:
  run-campaign-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt   # ★ requirements.txt 그대로 사용

      - name: Create client_secret.json
        run: |
          echo "${{ secrets.GA_CLIENT_SECRET_JSON }}" > client_secret.json

      - name: Restore GA token
        uses: actions/cache@v3
        with:
          path: ga_token.json
          key: ${{ runner.os }}-ga-token

      - name: Run campaign script
        env:
          GA_CLIENT_SECRET_FILE: "client_secret.json"
          GA_TOKEN_FILE: "ga_token.json"
          GA_PROPERTY_ID: ${{ secrets.GA_PROPERTY_ID }}
          GA_SEARCH_TERMS_SHEET_ID: ${{ secrets.GA_SEARCH_TERMS_SHEET_ID }}
        run: |
          python cafe24pro_parameter_campain.py  # ★ 너가 말한 정확한 실행 파일명

      - name: Save GA token
        uses: actions/cache@v3
        with:
          path: ga_token.json
          key: ${{ runner.os }}-ga-token
